var Qualli=function(){"use strict";function e(e,t,r,n,o,i,s){try{var a=e[i](s),u=a.value}catch(e){return void r(e)}a.done?t(u):Promise.resolve(u).then(n,o)}function t(t){return function(){var r=this,n=arguments;return new Promise((function(o,i){var s=t.apply(r,n);function a(t){e(s,o,i,a,u,"next",t)}function u(t){e(s,o,i,a,u,"throw",t)}a(void 0)}))}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:String(t)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function s(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,r){return(t=o(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var c={exports:{}},l={exports:{}};!function(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(l);var p=l.exports;!function(e){var t=p.default;function r(){e.exports=r=function(){return o},e.exports.__esModule=!0,e.exports.default=e.exports;var n,o={},i=Object.prototype,s=i.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},u="function"==typeof Symbol?Symbol:{},c=u.iterator||"@@iterator",l=u.asyncIterator||"@@asyncIterator",p=u.toStringTag||"@@toStringTag";function h(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(n){h=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof b?t:b,i=Object.create(o.prototype),s=new A(n||[]);return a(i,"_invoke",{value:L(e,r,s)}),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}o.wrap=f;var y="suspendedStart",v="executing",m="completed",g={};function b(){}function _(){}function x(){}var w={};h(w,c,(function(){return this}));var k=Object.getPrototypeOf,O=k&&k(k(D([])));O&&O!==i&&s.call(O,c)&&(w=O);var S=x.prototype=b.prototype=Object.create(w);function E(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,r){function n(o,i,a,u){var c=d(e[o],e,i);if("throw"!==c.type){var l=c.arg,p=l.value;return p&&"object"==t(p)&&s.call(p,"__await")?r.resolve(p.__await).then((function(e){n("next",e,a,u)}),(function(e){n("throw",e,a,u)})):r.resolve(p).then((function(e){l.value=e,a(l)}),(function(e){return n("throw",e,a,u)}))}u(c.arg)}var o;a(this,"_invoke",{value:function(e,t){function i(){return new r((function(r,o){n(e,t,r,o)}))}return o=o?o.then(i,i):i()}})}function L(e,t,r){var o=y;return function(i,s){if(o===v)throw new Error("Generator is already running");if(o===m){if("throw"===i)throw s;return{value:n,done:!0}}for(r.method=i,r.arg=s;;){var a=r.delegate;if(a){var u=j(a,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===y)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var c=d(e,t,r);if("normal"===c.type){if(o=r.done?m:"suspendedYield",c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=m,r.method="throw",r.arg=c.arg)}}}function j(e,t){var r=t.method,o=e.iterator[r];if(o===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=n,j(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var i=d(o,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,g;var s=i.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,g):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,g)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function D(e){if(e||""===e){var r=e[c];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function t(){for(;++o<e.length;)if(s.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=n,t.done=!0,t};return i.next=i}}throw new TypeError(t(e)+" is not iterable")}return _.prototype=x,a(S,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:_,configurable:!0}),_.displayName=h(x,p,"GeneratorFunction"),o.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,h(e,p,"GeneratorFunction")),e.prototype=Object.create(S),e},o.awrap=function(e){return{__await:e}},E(I.prototype),h(I.prototype,l,(function(){return this})),o.AsyncIterator=I,o.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var s=new I(f(e,t,r,n),i);return o.isGeneratorFunction(t)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},E(S),h(S,p,"Generator"),h(S,c,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),o.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},o.values=D,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(P),!e)for(var t in this)"t"===t.charAt(0)&&s.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,o){return a.type="throw",a.arg=e,t.next=r,o&&(t.method="next",t.arg=n),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=s.call(i,"catchLoc"),c=s.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&s.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;P(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:D(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),g}},o}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}(c);var h=(0,c.exports)(),f=h;try{regeneratorRuntime=h}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=h:Function("r","regeneratorRuntime = r")(h)}var d=u(f);
/*! js-cookie v3.0.5 | MIT */function y(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}var v=function e(t,r){function n(e,n,o){if("undefined"!=typeof document){"number"==typeof(o=y({},r,o)).expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var s in o)o[s]&&(i+="; "+s,!0!==o[s]&&(i+="="+o[s].split(";")[0]));return document.cookie=e+"="+t.write(n,e)+i}}return Object.create({set:n,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],n={},o=0;o<r.length;o++){var i=r[o].split("="),s=i.slice(1).join("=");try{var a=decodeURIComponent(i[0]);if(n[a]=t.read(s,a),e===a)break}catch(e){}}return e?n[e]:n}},remove:function(e,t){n(e,"",y({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,y({},this.attributes,t))},withConverter:function(t){return e(y({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),m="https://surveys.usequalli.com/surveys/popup",g="https://api.usequalli.com/api/";function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var x,w,k,O,S,E,I=function(){var e=t(d.mark((function e(t){var r,n,o,i,s,a,u,c,l;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.apiKey,n=t.url,o=t.method,i=t.headers,s=t.body,a={},e.prev=2,u={method:o,headers:_({Authorization:"Bearer ".concat(r),"Content-Type":"application/json",platform:"web"},i),body:s?JSON.stringify(_(_({},s),{},{event_metadata:a})):JSON.stringify({event_metadata:a})},e.next=6,fetch(n,u);case 6:if((c=e.sent).ok){e.next=9;break}throw new Error("API request failed: ".concat(c.statusText));case 9:return e.next=11,c.json();case 11:return l=e.sent,e.abrupt("return",l);case 15:throw e.prev=15,e.t0=e.catch(2),console.error("API request error: ".concat(e.t0.message)),e.t0;case 19:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(t){return e.apply(this,arguments)}}(),L=g,j={identify:(E=t(d.mark((function e(t,r,n){var o,i,s;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="".concat(L,"app-user/start-session"),i={},n&&(i.user_key=r),n&&(i.user_session_key=n),e.prev=4,e.next=7,I({apiKey:t,url:o,method:"POST",body:{},headers:i});case 7:if(!(s=e.sent).success){e.next=10;break}return e.abrupt("return",s);case 10:console.error("QUALLI: Failed to identify user"),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(4),console.error("QUALLI: Failed to identify user: ",e.t0),e.abrupt("return",{success:!1});case 17:case"end":return e.stop()}}),e,null,[[4,13]])}))),function(e,t,r){return E.apply(this,arguments)}),setUserAttributes:(S=t(d.mark((function e(t,r,n){var o,i;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Object.keys(n).length){e.next=2;break}return e.abrupt("return");case 2:if(o="".concat(L,"app-user/set-attributes"),r){e.next=6;break}return console.error("QUALLI: No session ID available"),e.abrupt("return");case 6:return i={"user-session-key":r},e.prev=7,e.next=10,I({apiKey:t,url:o,method:"POST",headers:i,body:{attributes:n,timestamp:new Date}});case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(7),console.error("QUALLI: Error setting user attributes: ",e.t0);case 15:case"end":return e.stop()}}),e,null,[[7,12]])}))),function(e,t,r){return S.apply(this,arguments)}),performTrigger:(O=t(d.mark((function e(t,r,n,o){var i,s,a;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n&&n.name||null!=n&&n.unique_id){e.next=2;break}return e.abrupt("return");case 2:if(i="".concat(L,"app-user-events/trigger"),r){e.next=6;break}return console.error("QUALLI: No session ID available"),e.abrupt("return");case 6:return s={"user-session-key":r},e.prev=7,e.next=10,I({apiKey:t,url:i,method:"POST",headers:s,body:{trigger:n,url:o,timestamp:new Date}});case 10:if(!(a=e.sent).success){e.next=13;break}return e.abrupt("return",a);case 13:console.error("QUALLI: Error performing trigger"),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(7),console.error("QUALLI: Error performing trigger: ",e.t0);case 19:case"end":return e.stop()}}),e,null,[[7,16]])}))),function(e,t,r,n){return O.apply(this,arguments)}),trackScreen:(k=t(d.mark((function e(t,r,n){var o,i,s;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n&&n.url){e.next=2;break}return e.abrupt("return");case 2:if(o="".concat(L,"app-user-events/screen"),r){e.next=6;break}return console.error("QUALLI: No session ID available"),e.abrupt("return");case 6:return i={"user-session-key":r},e.prev=7,e.next=10,I({apiKey:t,url:o,method:"POST",headers:i,body:{screen:n,timestamp:new Date}});case 10:if(!(s=e.sent).success){e.next=13;break}return e.abrupt("return",s);case 13:console.error("QUALLI: Error performing track screen"),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(7),console.error("QUALLI: Error performing track screen: ",e.t0);case 19:case"end":return e.stop()}}),e,null,[[7,16]])}))),function(e,t,r){return k.apply(this,arguments)}),logSurveyAction:(w=t(d.mark((function e(t,r,n,o,i){var s,a;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s="".concat(L,"surveys/").concat(n,"/action"),r){e.next=4;break}return console.error("QUALLI: No session ID available"),e.abrupt("return");case 4:return a={"user-session-key":r},e.prev=5,e.next=8,I({apiKey:t,url:s,method:"POST",headers:a,body:{action:o,data:i,timestamp:new Date}});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),console.error("QUALLI: Error logging the survey action: ",e.t0);case 13:case"end":return e.stop()}}),e,null,[[5,10]])}))),function(e,t,r,n,o){return w.apply(this,arguments)}),logEvent:(x=t(d.mark((function e(t,r,n){var o,i;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o="".concat(L,"app-user-events/store"),r){e.next=4;break}return console.error("QUALLI: No session ID available"),e.abrupt("return");case 4:return i={"user-session-key":r},e.prev=5,e.next=8,I({apiKey:t,url:o,method:"POST",headers:i,body:{action:n,event_name:n,timestamp:new Date}});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),console.error("QUALLI: Error logging the action: ",e.t0);case 13:case"end":return e.stop()}}),e,null,[[5,10]])}))),function(e,t,r){return x.apply(this,arguments)})},T={screens:{large:{position:"fixed",width:"350px",height:"250px",bottom:"-100%","border-radius":"12px",border:"none",opacity:1,transition:"all 400ms ease-in-out"},small:{position:"fixed",left:"16px",right:"16px",bottom:"-100%",width:"calc(100% - 32px)",height:"200px","border-radius":"12px",border:"none","max-height":"100%",transition:"all 400ms ease-in-out"}},popupPlacement:{left:{left:"16px"},center:{left:"50%",transform:"translate(-50%, 0)"},right:{right:"16px"}},person:{base:{small:{position:"fixed",opacity:0,transition:"all 400ms ease-in-out",cursor:"pointer",bottom:"16px",background:"none",overflow:"hidden"},large:{position:"fixed",opacity:0,transition:"all 400ms ease-in-out",cursor:"pointer",bottom:"16px",background:"none",overflow:"hidden"}},type:{circle:{small:{width:"60px",height:"60px","border-radius":"50%"},large:{width:"75px",height:"75px","border-radius":"50%"}},rectangle:{small:{width:"60px",height:"90px","border-radius":"6px"},large:{width:"60px",height:"90px","border-radius":"6px"}}},position:{small:{bottom_left:{left:"16px"},bottom_center:{left:"50%",transform:"translate(-50%, 0)"},bottom_right:{right:"16px"}},large:{bottom_left:{left:"16px"},bottom_center:{left:"50%",transform:"translate(-50%, 0)"},bottom_right:{right:"16px"}}}}},P=function(e){return e.none="none",e.small="small",e.medium="medium",e.large="large",e}({}),A=function(e){return e.SURVEY_COMPLETED="survey_completed",e.SURVEY_SHOWN="survey_shown",e.SURVEY_CLOSED="survey_closed",e}({}),D=function(){function e(){r(this,e),a(this,"events",{})}return s(e,[{key:"on",value:function(e,t){var r=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(t),function(){return r.off(e,t)}}},{key:"off",value:function(e,t){this.events[e]&&(this.events[e]=this.events[e].filter((function(e){return e!==t})))}},{key:"emit",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.events[e]&&this.events[e].forEach((function(e){return e.apply(void 0,r)}))}}]),e}(),C=new D;function U(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?U(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var q=function(){function e(){var t=this;r(this,e),a(this,"company",{}),a(this,"ready",!1),a(this,"_popupId","qualli-survey-popup-iframe"),a(this,"_personId","qualli-survey-person"),a(this,"_userSessionKey",""),a(this,"_userKey",""),a(this,"_apiKey",""),a(this,"_popupInFrame",!1),a(this,"_previousUrl",""),a(this,"_triggerQueue",[]),a(this,"_attributesQueue",[]),a(this,"_activeTriggers",[]),a(this,"_trackScreens",!1),a(this,"_canTrackScrollDepthAgain",!0),a(this,"_postMessage",(function(e,r){var n=document.getElementById(t._popupId);n&&n.contentWindow.postMessage({message:{type:e,data:r}},"*")})),this._handleIframeMessages=this._handleIframeMessages.bind(this)}var n,o,i,u,c,l;return s(e,[{key:"init",value:(l=t(d.mark((function e(t,r){return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._apiKey=t,e.next=3,this.identify();case 3:this.ready=!0,(null!=r&&r.trackScreens||!r)&&(this._trackScreens=!0,this._trackScreenChange()),this._setupScreenTracking(),this._checkQueueAfterInit();case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"identify",value:function(){var e=t(d.mark((function e(){var t,r,n;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.get("qualli_user_key"),r=v.get("qualli_user_session_key"),e.next=4,j.identify(this._apiKey,t,r);case 4:if(null!=(n=e.sent)&&n.success&&null!=n&&n.app_user_key&&null!=n&&n.session_key){e.next=7;break}return e.abrupt("return");case 7:v.set("qualli_user_session_key",n.session_key),v.set("qualli_user_key",n.app_user_key),this._userSessionKey=n.session_key,this._userKey=n.app_user_key,this.company=n.company_info,this._activeTriggers=n.triggers,this._setupActiveTriggerTracking();case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_checkQueueAfterInit",value:(c=t(d.mark((function e(){var r=this;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this._attributesQueue.length>0)){e.next=3;break}return e.next=3,Promise.all(this._attributesQueue.map(function(){var e=t(d.mark((function e(t){return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.setAttributes(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:this._triggerQueue.length>0&&this._triggerQueue.forEach(function(){var e=t(d.mark((function e(t){return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.key){e.next=5;break}return e.next=3,r._performTrigger(t.key,null);case 3:e.next=8;break;case 5:if(!t.uniqueId){e.next=8;break}return e.next=8,r._performTrigger(null,t.uniqueId);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"performTrigger",value:(u=t(d.mark((function e(t){return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._performTrigger(t,null);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"setAttributes",value:(i=t(d.mark((function e(){var t,r=arguments;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:{},this.ready){e.next=4;break}return this._attributesQueue.push(t),e.abrupt("return");case 4:return e.next=6,j.setUserAttributes(this._apiKey,this._userSessionKey,t);case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"reset",value:function(){var e=this;this._popupInFrame&&this._closePopup(),v.remove("qualli_user_session_key"),v.remove("qualli_user_key"),this.ready=!1,this._userSessionKey="",this._userKey="",this._surveyToComplete=void 0,this._popupInFrame=!1,this._previousUrl="",setTimeout((function(){e.init(e._apiKey)}),1e3)}},{key:"on",value:function(e,t){return C.on(e,t),function(){C.off(e,t)}}},{key:"_setupScreenTracking",value:function(){var e=this,t=history.pushState,r=history.replaceState;history.pushState=function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];t.apply(history,n),e._trackScreenChange()},history.replaceState=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];r.apply(history,n),e._trackScreenChange()},window.addEventListener("popstate",(function(){e._trackScreenChange()}))}},{key:"_performTrigger",value:(o=t(d.mark((function e(t,r){var n,o,i,s,a,u;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ready){e.next=3;break}return t?this._triggerQueue.push({key:t}):r&&this._triggerQueue.push({uniqueId:r}),e.abrupt("return");case 3:if(!t){e.next=9;break}return e.next=6,j.performTrigger(this._apiKey,this._userSessionKey,{name:t},window.location.href);case 6:o=e.sent,e.next=13;break;case 9:if(!r){e.next=13;break}return e.next=12,j.performTrigger(this._apiKey,this._userSessionKey,{unique_id:r},window.location.href);case 12:o=e.sent;case 13:if(null===(n=o)||void 0===n||!n.success){e.next=23;break}if(!((null==(s=null===(i=o)||void 0===i||null===(i=i.data)||void 0===i||null===(i=i.surveys)||void 0===i?void 0:i.data)?void 0:s.length)>0)){e.next=23;break}if(this._popupInFrame){e.next=23;break}if(!(null===(a=s[0])||void 0===a?void 0:a.delay)){e.next=21;break}return this._handleSurveyDelay(s[0],null===(u=o)||void 0===u||null===(u=u.data)||void 0===u?void 0:u.timestamp),e.abrupt("return");case 21:return this._showPopup(s[0]),e.abrupt("return");case 23:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"_trackScreenChange",value:(n=t(d.mark((function e(){var t,r,n,o,i,s,a;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._canTrackScrollDepthAgain=!0,this._trackScreens){e.next=3;break}return e.abrupt("return");case 3:if(t=window.location.href,(r=t.split("?")[0])!==this._previousUrl){e.next=7;break}return e.abrupt("return");case 7:return this._previousUrl=r,e.next=10,j.trackScreen(this._apiKey,this._userSessionKey,{url:r});case 10:if(null==(n=e.sent)||!n.success){e.next=21;break}if(!((null==(i=null==n||null===(o=n.data)||void 0===o||null===(o=o.surveys)||void 0===o?void 0:o.data)?void 0:i.length)>0)){e.next=21;break}if(this._popupInFrame){e.next=21;break}if(!(null===(s=i[0])||void 0===s?void 0:s.delay)){e.next=19;break}return this._handleSurveyDelay(i[0],null==n||null===(a=n.data)||void 0===a?void 0:a.timestamp),e.abrupt("return");case 19:return this._showPopup(i[0]),e.abrupt("return");case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_showPopup",value:function(e){this._surveyToComplete=e,this._popupInFrame=!0;var t=window.innerWidth>600,r=document.createElement("iframe"),n={survey_id:e.unique_identifier,popup:"true"},o=Object.keys(n).map((function(e){return e+"="+n[e]})).join("&"),i=(null==e?void 0:e.popup_placement)||"bottom_right",s=function(e){switch(e){case P.none:return 0;case P.small:return 10;case P.medium:return 18;case P.large:return 24;default:return 10}}(e.theme.popup_rounded_corners||P.medium),a=e.theme.popup_border_width+"px"||"0px",u=T.popupPlacement.left;"bottom_right"===i?u=T.popupPlacement.right:"bottom_center"===i&&(u=T.popupPlacement.center);var c={};t?Object.assign(c,K(K({},T.screens.large),u)):Object.assign(c,K({},T.screens.small)),Object.assign(c,{borderRadius:s,borderColor:"#000000",borderWidth:a,backgroundColor:e.theme.background_color,border:"solid",zIndex:999}),Object.assign(r.style,c),r.src="".concat(m,"?").concat(o),r.id=this._popupId,document.body.appendChild(r);var l=null==e?void 0:e.person;if(l&&l.video_url){this._addPerson(l,(function(){setTimeout((function(){"circle"===l.style.type?r.style.bottom="100px":r.style.bottom="115px"}),"2-step"===l.logic?0:800)}),t,e)}else setTimeout((function(){window.innerWidth<600?r.style.bottom="16px":r.style.bottom="24px"}),100);window.addEventListener("message",this._handleIframeMessages,!1),this._emitSurvetShown(e)}},{key:"_emitSurvetShown",value:function(e){var t;C.emit(A.SURVEY_SHOWN,{survey_unique_identifier:null===(t=this._surveyToComplete)||void 0===t?void 0:t.unique_identifier})}},{key:"_handleSurveyDelay",value:function(e,t){var r=this;this._surveyToComplete=e,this._popupInFrame=!0;var n=e.delay,o=new Date(t);o.setSeconds(o.getSeconds()+n);var i=setInterval((function(){new Date>=o&&(r._showPopup(e),clearInterval(i))}),200)}},{key:"_handleIframeMessages",value:function(e){var t;if(null!=e&&null!==(t=e.data)&&void 0!==t&&t.message){var r,n,o=e.data.message;if("close"===o.type&&this._closePopup(),"ready"===o.type)this._postMessage("survey_to_complete",this._surveyToComplete),this._postMessage("auth",{userSessionKey:this._userSessionKey,apiKey:this._apiKey,companyPlan:null===(r=this.company)||void 0===r?void 0:r.plan});if("survey_completed"===o.type)C.emit(A.SURVEY_COMPLETED,{survey_unique_identifier:null===(n=this._surveyToComplete)||void 0===n?void 0:n.unique_identifier,answers:o.data.answers});if("survey_aborted"===o.type&&this._closePopup(),"window_height_request"===o.type){var i=o.data.height;this._resizePopup(i)}}}},{key:"_resizePopup",value:function(e){if(!isNaN(e)){var t,r=document.getElementById(this._popupId),n=e,o=null==r||null===(t=r.style)||void 0===t?void 0:t.borderWidth,i=new RegExp("^\\d+(px)?$");o&&i.test(o)&&(n-=parseInt(o)),r&&(r.style.height=n+"px")}}},{key:"_closePopup",value:function(){var e;this._popupInFrame=!1,window.removeEventListener("message",this._handleIframeMessages),C.emit(A.SURVEY_CLOSED,{survey_unique_identifier:null===(e=this._surveyToComplete)||void 0===e?void 0:e.unique_identifier});var t=document.getElementById(this._popupId),r=document.getElementById(this._personId);t&&(t.style.bottom="-100%",t.style.opacity="0",setTimeout((function(){t.remove()}),1e3)),r&&(r.style.opacity="0",r.remove())}},{key:"_addPerson",value:function(e,t,r,n){var o=document.createElement("div"),i=document.createElement("video");i.src=e.video_url,i.loop=!0,i.muted=!0,i.autoplay=!0,i.playsInline=!0,o.id=this._personId;var s={},a={},u={},c=T.person.position.large;switch(r||(c=T.person.position.small),n.popup_placement||"bottom_right"){case"bottom_left":Object.assign(s,K({},c.bottom_left));break;case"bottom_center":Object.assign(s,K({},c.bottom_center));break;case"bottom_right":Object.assign(s,K({},c.bottom_right))}"circle"===e.style.type?Object.assign(a,K({},T.person.type.circle.large)):Object.assign(a,K({},T.person.type.rectangle.large)),Object.assign(u,K({},T.person.base.large)),Object.assign(o.style,K(K(K(K({},u),a),s),{},{border:"solid ".concat(e.style.border_width,"px ").concat(e.style.border_color)})),i.style.width="100%",i.style.height="100%",i.style.objectFit="cover","2-step"===e.logic&&(o.onclick=t),document.body.appendChild(o),o.appendChild(i),setTimeout((function(){o.style.opacity="1","1-step"===e.logic&&t()}),400)}},{key:"_setupActiveTriggerTracking",value:function(){var e,t,r,n,o,i=this,s=(r=function(){if(i._canTrackScrollDepthAgain){var e=window.scrollY/(document.documentElement.scrollHeight-window.innerHeight)*100;i._activeTriggers.forEach((function(t){t.scroll_depth&&e>=t.scroll_depth&&(i._canTrackScrollDepthAgain=!1,i._performTrigger(null,t.unique_identifier))}))}},n=200,function(){var e=arguments,t=this;o||(r.apply(t,e),o=!0,setTimeout((function(){return o=!1}),n))});null!==(e=this._activeTriggers)&&void 0!==e&&e.some((function(e){return null!==e.scroll_depth}))&&window.addEventListener("scroll",s);null!==(t=this._activeTriggers)&&void 0!==t&&t.some((function(e){return e.unique_key||e.css_selector||e.inner_text}))&&document.body.addEventListener("click",(function(e){var t;null===(t=i._activeTriggers)||void 0===t||t.forEach((function(t){var r=e.target;(t.css_selector&&r.matches(t.css_selector)||t.inner_text&&r.innerText===t.inner_text)&&i._performTrigger(null,t.unique_identifier)}))}))}}]),e}();return new q}();
//# sourceMappingURL=index.browser.js.map
