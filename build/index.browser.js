var Qualli=function(){"use strict";function e(e,t,r,n,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function t(t){return function(){var r=this,n=arguments;return new Promise((function(o,i){var a=t.apply(r,n);function s(t){e(a,o,i,s,u,"next",t)}function u(t){e(a,o,i,s,u,"throw",t)}s(void 0)}))}}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:String(t)}function o(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,n(o.key),o)}}function i(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var s={exports:{}},u={exports:{}};!function(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(u);var c=u.exports;!function(e){var t=c.default;function r(){e.exports=r=function(){return o},e.exports.__esModule=!0,e.exports.default=e.exports;var n,o={},i=Object.prototype,a=i.hasOwnProperty,s=Object.defineProperty||function(e,t,r){e[t]=r.value},u="function"==typeof Symbol?Symbol:{},c=u.iterator||"@@iterator",p=u.asyncIterator||"@@asyncIterator",l=u.toStringTag||"@@toStringTag";function f(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(n){f=function(e,t,r){return e[t]=r}}function h(e,t,r,n){var o=t&&t.prototype instanceof g?t:g,i=Object.create(o.prototype),a=new A(n||[]);return s(i,"_invoke",{value:j(e,r,a)}),i}function y(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}o.wrap=h;var d="suspendedStart",v="executing",m="completed",b={};function g(){}function w(){}function x(){}var k={};f(k,c,(function(){return this}));var _=Object.getPrototypeOf,O=_&&_(_(U([])));O&&O!==i&&a.call(O,c)&&(k=O);var L=x.prototype=g.prototype=Object.create(k);function S(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function P(e,r){function n(o,i,s,u){var c=y(e[o],e,i);if("throw"!==c.type){var p=c.arg,l=p.value;return l&&"object"==t(l)&&a.call(l,"__await")?r.resolve(l.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):r.resolve(l).then((function(e){p.value=e,s(p)}),(function(e){return n("throw",e,s,u)}))}u(c.arg)}var o;s(this,"_invoke",{value:function(e,t){function i(){return new r((function(r,o){n(e,t,r,o)}))}return o=o?o.then(i,i):i()}})}function j(e,t,r){var o=d;return function(i,a){if(o===v)throw new Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:n,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var u=I(s,r);if(u){if(u===b)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var c=y(e,t,r);if("normal"===c.type){if(o=r.done?m:"suspendedYield",c.arg===b)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=m,r.method="throw",r.arg=c.arg)}}}function I(e,t){var r=t.method,o=e.iterator[r];if(o===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=n,I(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),b;var i=y(o,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,b;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,b):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,b)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function U(e){if(e||""===e){var r=e[c];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function t(){for(;++o<e.length;)if(a.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=n,t.done=!0,t};return i.next=i}}throw new TypeError(t(e)+" is not iterable")}return w.prototype=x,s(L,"constructor",{value:x,configurable:!0}),s(x,"constructor",{value:w,configurable:!0}),w.displayName=f(x,l,"GeneratorFunction"),o.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,f(e,l,"GeneratorFunction")),e.prototype=Object.create(L),e},o.awrap=function(e){return{__await:e}},S(P.prototype),f(P.prototype,p,(function(){return this})),o.AsyncIterator=P,o.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var a=new P(h(e,t,r,n),i);return o.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(L),f(L,l,"Generator"),f(L,c,(function(){return this})),f(L,"toString",(function(){return"[object Generator]"})),o.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},o.values=U,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,o){return s.type="throw",s.arg=e,t.next=r,o&&(t.method="next",t.arg=n),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),c=a.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:U(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),b}},o}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}(s);var p=(0,s.exports)(),l=p;try{regeneratorRuntime=p}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=p:Function("r","regeneratorRuntime = r")(p)}var f=a(l);
/*! js-cookie v3.0.5 | MIT */function h(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}var y=function e(t,r){function n(e,n,o){if("undefined"!=typeof document){"number"==typeof(o=h({},r,o)).expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var a in o)o[a]&&(i+="; "+a,!0!==o[a]&&(i+="="+o[a].split(";")[0]));return document.cookie=e+"="+t.write(n,e)+i}}return Object.create({set:n,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],n={},o=0;o<r.length;o++){var i=r[o].split("="),a=i.slice(1).join("=");try{var s=decodeURIComponent(i[0]);if(n[s]=t.read(a,s),e===s)break}catch(e){}}return e?n[e]:n}},remove:function(e,t){n(e,"",h({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,h({},this.attributes,t))},withConverter:function(t){return e(h({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),d="https://surveys.usequalli.com/surveys/popup",v="https://api.usequalli.com/api/";function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var g,w,x,k,_,O,L=function(){var e=t(f.mark((function e(t){var r,n,o,i,a,s,u,c,p;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.apiKey,n=t.url,o=t.method,i=t.headers,a=t.body,s={},e.prev=2,u={method:o,headers:b({Authorization:"Bearer ".concat(r),"Content-Type":"application/json",platform:"web"},i),body:a?JSON.stringify(b(b({},a),{},{event_metadata:s})):JSON.stringify({event_metadata:s})},e.next=6,fetch(n,u);case 6:if((c=e.sent).ok){e.next=9;break}throw new Error("API request failed: ".concat(c.statusText));case 9:return e.next=11,c.json();case 11:return p=e.sent,e.abrupt("return",p);case 15:throw e.prev=15,e.t0=e.catch(2),console.error("API request error: ".concat(e.t0.message)),e.t0;case 19:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(t){return e.apply(this,arguments)}}(),S=v,P={identify:(O=t(f.mark((function e(t,r,n){var o,i,a;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="".concat(S,"app-user/start-session"),i={},n&&(i.user_key=r),n&&(i.user_session_key=n),e.prev=4,e.next=7,L({apiKey:t,url:o,method:"POST",body:{},headers:i});case 7:if(!(a=e.sent).success){e.next=10;break}return e.abrupt("return",a);case 10:console.error("QUALLI: Failed to identify user"),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(4),console.error("QUALLI: Failed to identify user: ",e.t0),e.abrupt("return",{success:!1});case 17:case"end":return e.stop()}}),e,null,[[4,13]])}))),function(e,t,r){return O.apply(this,arguments)}),setUserAttributes:(_=t(f.mark((function e(t,r,n){var o,i;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Object.keys(n).length){e.next=2;break}return e.abrupt("return");case 2:if(o="".concat(S,"app-user/set-attributes"),r){e.next=6;break}return console.error("QUALLI: No session ID available"),e.abrupt("return");case 6:return i={"user-session-key":r},e.prev=7,e.next=10,L({apiKey:t,url:o,method:"POST",headers:i,body:{attributes:n,timestamp:new Date}});case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(7),console.error("QUALLI: Error setting user attributes: ",e.t0);case 15:case"end":return e.stop()}}),e,null,[[7,12]])}))),function(e,t,r){return _.apply(this,arguments)}),performTrigger:(k=t(f.mark((function e(t,r,n){var o,i,a;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n&&n.name){e.next=2;break}return e.abrupt("return");case 2:if(o="".concat(S,"app-user-events/trigger"),r){e.next=6;break}return console.error("QUALLI: No session ID available"),e.abrupt("return");case 6:return i={"user-session-key":r},e.prev=7,e.next=10,L({apiKey:t,url:o,method:"POST",headers:i,body:{trigger:n,timestamp:new Date}});case 10:if(!(a=e.sent).success){e.next=13;break}return e.abrupt("return",a);case 13:console.error("QUALLI: Error performing trigger"),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(7),console.error("QUALLI: Error performing trigger: ",e.t0);case 19:case"end":return e.stop()}}),e,null,[[7,16]])}))),function(e,t,r){return k.apply(this,arguments)}),trackScreen:(x=t(f.mark((function e(t,r,n){var o,i,a;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n&&n.url){e.next=2;break}return e.abrupt("return");case 2:if(o="".concat(S,"app-user-events/screen"),r){e.next=6;break}return console.error("QUALLI: No session ID available"),e.abrupt("return");case 6:return i={"user-session-key":r},e.prev=7,e.next=10,L({apiKey:t,url:o,method:"POST",headers:i,body:{screen:n,timestamp:new Date}});case 10:if(!(a=e.sent).success){e.next=13;break}return e.abrupt("return",a);case 13:console.error("QUALLI: Error performing track screen"),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(7),console.error("QUALLI: Error performing track screen: ",e.t0);case 19:case"end":return e.stop()}}),e,null,[[7,16]])}))),function(e,t,r){return x.apply(this,arguments)}),logSurveyAction:(w=t(f.mark((function e(t,r,n,o,i){var a,s;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a="".concat(S,"surveys/").concat(n,"/action"),r){e.next=4;break}return console.error("QUALLI: No session ID available"),e.abrupt("return");case 4:return s={"user-session-key":r},e.prev=5,e.next=8,L({apiKey:t,url:a,method:"POST",headers:s,body:{action:o,data:i,timestamp:new Date}});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),console.error("QUALLI: Error logging the survey action: ",e.t0);case 13:case"end":return e.stop()}}),e,null,[[5,10]])}))),function(e,t,r,n,o){return w.apply(this,arguments)}),logEvent:(g=t(f.mark((function e(t,r,n){var o,i;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o="".concat(S,"app-user-events/store"),r){e.next=4;break}return console.error("QUALLI: No session ID available"),e.abrupt("return");case 4:return i={"user-session-key":r},e.prev=5,e.next=8,L({apiKey:t,url:o,method:"POST",headers:i,body:{action:n,event_name:n,timestamp:new Date}});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),console.error("QUALLI: Error logging the action: ",e.t0);case 13:case"end":return e.stop()}}),e,null,[[5,10]])}))),function(e,t,r){return g.apply(this,arguments)})},j={screens:{large:{position:"fixed",width:"400px",height:"250px",bottom:"-100%","border-radius":"12px",border:"none",opacity:1,transition:"all 400ms ease-in-out"},small:{position:"fixed",left:"0",bottom:"-100%",width:"100%",height:"200px",border:"none","max-height":"100%","border-top-left-radius":"16px","border-top-right-radius":"16px",transition:"all 400ms ease-in-out"}},popupPlacement:{left:{left:"24px"},center:{left:"50%",transform:"translate(-50%, 0)"},right:{right:"24px"}}},I=function(e){return e.none="none",e.small="small",e.medium="medium",e.large="large",e}({});function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function T(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?E(Object(r),!0).forEach((function(t){i(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var A=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"popupId","qualli-survey-popup-iframe"),i(this,"company",{}),i(this,"ready",!1),i(this,"userSessionKey",""),i(this,"userKey",""),i(this,"apiKey",""),i(this,"popupInFrame",!1),i(this,"previousUrl",""),i(this,"postMessage",(function(e,r){var n=document.getElementById(t.popupId);n&&n.contentWindow.postMessage({message:{type:e,data:r}},"*")})),this.handleIframeMessages=this.handleIframeMessages.bind(this)}var r,n,a,s,u,c;return r=e,n=[{key:"init",value:(c=t(f.mark((function e(t,r){var n,o,i;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=y.get("qualli_user_key"),o=y.get("qualli_user_session_key"),this.apiKey=t,e.next=5,P.identify(t,n,o);case 5:if(null!=(i=e.sent)&&i.success&&null!=i&&i.app_user_key&&null!=i&&i.session_key){e.next=8;break}return e.abrupt("return");case 8:y.set("qualli_user_session_key",i.session_key),y.set("qualli_user_key",i.app_user_key),this.userSessionKey=i.session_key,this.userKey=i.app_user_key,this.company=i.company_info,this.ready=!0,(null!=r&&r.trackScreens||!r)&&(this.trackScreenChange(),this.setupScreenTracking());case 15:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"performTrigger",value:function(){var e=t(f.mark((function e(t){var r,n,o;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P.performTrigger(this.apiKey,this.userSessionKey,{name:t});case 2:if(null==(r=e.sent)||!r.success){e.next=9;break}if(!((null==(o=null==r||null===(n=r.data)||void 0===n||null===(n=n.surveys)||void 0===n?void 0:n.data)?void 0:o.length)>0)){e.next=9;break}if(this.popupInFrame){e.next=9;break}return this.showPopup(o[0]),e.abrupt("return");case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setAttributes",value:(u=t(f.mark((function e(){var t,r=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,P.setUserAttributes(this.apiKey,this.userSessionKey,t);case 3:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"reset",value:function(){var e=this;this.popupInFrame&&this.closePopup(),y.remove("qualli_user_session_key"),y.remove("qualli_user_key"),this.ready=!1,this.userSessionKey="",this.userKey="",this.surveyToComplete=void 0,this.popupInFrame=!1,this.previousUrl="",setTimeout((function(){e.init(e.apiKey)}),1e3)}},{key:"setupScreenTracking",value:function(){var e=this,t=history.pushState,r=history.replaceState;history.pushState=function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];t.apply(history,n),e.trackScreenChange()},history.replaceState=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];r.apply(history,n),e.trackScreenChange()},window.addEventListener("popstate",(function(){e.trackScreenChange()}))}},{key:"trackScreenChange",value:(s=t(f.mark((function e(){var t,r,n,o,i;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window.location.href,(r=t.split("?")[0])!==this.previousUrl){e.next=4;break}return e.abrupt("return");case 4:return this.previousUrl=r,e.next=7,P.trackScreen(this.apiKey,this.userSessionKey,{url:r});case 7:if(null==(n=e.sent)||!n.success){e.next=14;break}if(!((null==(i=null==n||null===(o=n.data)||void 0===o||null===(o=o.surveys)||void 0===o?void 0:o.data)?void 0:i.length)>0)){e.next=14;break}if(this.popupInFrame){e.next=14;break}return this.showPopup(i[0]),e.abrupt("return");case 14:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"showPopup",value:function(e){this.surveyToComplete=e,this.popupInFrame=!0;var t=document.createElement("iframe"),r={survey_id:e.unique_identifier,popup:"true"},n=Object.keys(r).map((function(e){return e+"="+r[e]})).join("&"),o=(null==e?void 0:e.popup_placement)||"bottom_right",i=function(e){switch(e){case I.none:return 0;case I.small:return 10;case I.medium:return 18;case I.large:return 24;default:return 10}}(e.theme.popup_rounded_corners||I.medium),a=e.theme.popup_border_color||"#000000",s=e.theme.popup_border_width+"px"||"0px",u=j.popupPlacement.left;"bottom_right"===o?u=j.popupPlacement.right:"bottom_center"===o&&(u=j.popupPlacement.center),window.innerWidth<600?Object.assign(t.style,T(T({},j.screens.small),{},{borderTopLeftRadius:i,borderTopRightRadius:i,zIndex:999})):Object.assign(t.style,T(T(T({},j.screens.large),u),{},{borderRadius:i,borderColor:a,borderWidth:s,border:"solid",zIndex:999})),t.src="".concat(d,"?").concat(n),t.id=this.popupId,document.body.appendChild(t),setTimeout((function(){window.innerWidth<600?t.style.bottom="0":t.style.bottom="24px"}),100),window.addEventListener("message",this.handleIframeMessages,!1)}},{key:"handleIframeMessages",value:function(e){var t;if(null!=e&&null!==(t=e.data)&&void 0!==t&&t.message){var r,n=e.data.message;if("close"===n.type&&this.closePopup(),"ready"===n.type&&(this.postMessage("survey_to_complete",this.surveyToComplete),this.postMessage("auth",{userSessionKey:this.userSessionKey,apiKey:this.apiKey,companyPlan:null===(r=this.company)||void 0===r?void 0:r.plan})),"survey_completed"===n.type&&this.closePopup(),"survey_aborted"===n.type&&this.closePopup(),"window_height_request"===n.type){var o=n.data.height;this.resizePopup(o)}}}},{key:"resizePopup",value:function(e){if(!isNaN(e)){var t=document.getElementById(this.popupId);t&&(t.style.height=e+"px")}}},{key:"closePopup",value:function(){this.popupInFrame=!1,window.removeEventListener("message",this.handleIframeMessages);var e=document.getElementById(this.popupId);e&&(e.style.bottom="-100%",e.style.opacity="0",setTimeout((function(){e.remove()}),1e3))}}],n&&o(r.prototype,n),a&&o(r,a),Object.defineProperty(r,"prototype",{writable:!1}),e}();return new A}();
//# sourceMappingURL=index.browser.js.map
