var Qualli=function(){"use strict";function e(e,t,r,n,o,i,a){try{var s=e[i](a),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function t(t){return function(){var r=this,n=arguments;return new Promise((function(o,i){var a=t.apply(r,n);function s(t){e(a,o,i,s,u,"next",t)}function u(t){e(a,o,i,s,u,"throw",t)}s(void 0)}))}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function o(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var o=r.call(e,t||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:String(t)}function i(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,o(n.key),n)}}function a(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,r){return(t=o(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var c={exports:{}},p={exports:{}};!function(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports}(p);var l=p.exports;!function(e){var t=l.default;function r(){e.exports=r=function(){return o},e.exports.__esModule=!0,e.exports.default=e.exports;var n,o={},i=Object.prototype,a=i.hasOwnProperty,s=Object.defineProperty||function(e,t,r){e[t]=r.value},u="function"==typeof Symbol?Symbol:{},c=u.iterator||"@@iterator",p=u.asyncIterator||"@@asyncIterator",l=u.toStringTag||"@@toStringTag";function f(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},"")}catch(n){f=function(e,t,r){return e[t]=r}}function h(e,t,r,n){var o=t&&t.prototype instanceof g?t:g,i=Object.create(o.prototype),a=new C(n||[]);return s(i,"_invoke",{value:L(e,r,a)}),i}function y(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}o.wrap=h;var d="suspendedStart",v="executing",m="completed",b={};function g(){}function _(){}function w(){}var x={};f(x,c,(function(){return this}));var k=Object.getPrototypeOf,O=k&&k(k(U([])));O&&O!==i&&a.call(O,c)&&(x=O);var S=w.prototype=g.prototype=Object.create(x);function E(e){["next","throw","return"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function j(e,r){function n(o,i,s,u){var c=y(e[o],e,i);if("throw"!==c.type){var p=c.arg,l=p.value;return l&&"object"==t(l)&&a.call(l,"__await")?r.resolve(l.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):r.resolve(l).then((function(e){p.value=e,s(p)}),(function(e){return n("throw",e,s,u)}))}u(c.arg)}var o;s(this,"_invoke",{value:function(e,t){function i(){return new r((function(r,o){n(e,t,r,o)}))}return o=o?o.then(i,i):i()}})}function L(e,t,r){var o=d;return function(i,a){if(o===v)throw new Error("Generator is already running");if(o===m){if("throw"===i)throw a;return{value:n,done:!0}}for(r.method=i,r.arg=a;;){var s=r.delegate;if(s){var u=I(s,r);if(u){if(u===b)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var c=y(e,t,r);if("normal"===c.type){if(o=r.done?m:"suspendedYield",c.arg===b)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(o=m,r.method="throw",r.arg=c.arg)}}}function I(e,t){var r=t.method,o=e.iterator[r];if(o===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=n,I(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),b;var i=y(o,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,b;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,b):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,b)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function U(e){if(e||""===e){var r=e[c];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function t(){for(;++o<e.length;)if(a.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=n,t.done=!0,t};return i.next=i}}throw new TypeError(t(e)+" is not iterable")}return _.prototype=w,s(S,"constructor",{value:w,configurable:!0}),s(w,"constructor",{value:_,configurable:!0}),_.displayName=f(w,l,"GeneratorFunction"),o.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},o.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,f(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},o.awrap=function(e){return{__await:e}},E(j.prototype),f(j.prototype,p,(function(){return this})),o.AsyncIterator=j,o.async=function(e,t,r,n,i){void 0===i&&(i=Promise);var a=new j(h(e,t,r,n),i);return o.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},E(S),f(S,l,"Generator"),f(S,c,(function(){return this})),f(S,"toString",(function(){return"[object Generator]"})),o.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},o.values=U,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&a.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,o){return s.type="throw",s.arg=e,t.next=r,o&&(t.method="next",t.arg=n),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],s=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=a.call(i,"catchLoc"),c=a.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;T(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:U(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=n),b}},o}e.exports=r,e.exports.__esModule=!0,e.exports.default=e.exports}(c);var f=(0,c.exports)(),h=f;try{regeneratorRuntime=f}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=f:Function("r","regeneratorRuntime = r")(f)}var y=u(h);
/*! js-cookie v3.0.5 | MIT */function d(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)e[n]=r[n]}return e}var v=function e(t,r){function n(e,n,o){if("undefined"!=typeof document){"number"==typeof(o=d({},r,o)).expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var a in o)o[a]&&(i+="; "+a,!0!==o[a]&&(i+="="+o[a].split(";")[0]));return document.cookie=e+"="+t.write(n,e)+i}}return Object.create({set:n,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],n={},o=0;o<r.length;o++){var i=r[o].split("="),a=i.slice(1).join("=");try{var s=decodeURIComponent(i[0]);if(n[s]=t.read(a,s),e===s)break}catch(e){}}return e?n[e]:n}},remove:function(e,t){n(e,"",d({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,d({},this.attributes,t))},withConverter:function(t){return e(d({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"}),m="https://surveys.usequalli.com/surveys/popup",b="https://api.usequalli.com/api/";function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var w,x,k,O,S,E,j=function(){var e=t(y.mark((function e(t){var r,n,o,i,a,s,u,c,p;return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.apiKey,n=t.url,o=t.method,i=t.headers,a=t.body,s={},e.prev=2,u={method:o,headers:_({Authorization:"Bearer ".concat(r),"Content-Type":"application/json",platform:"web"},i),body:a?JSON.stringify(_(_({},a),{},{event_metadata:s})):JSON.stringify({event_metadata:s})},e.next=6,fetch(n,u);case 6:if((c=e.sent).ok){e.next=9;break}throw new Error("API request failed: ".concat(c.statusText));case 9:return e.next=11,c.json();case 11:return p=e.sent,e.abrupt("return",p);case 15:throw e.prev=15,e.t0=e.catch(2),console.error("API request error: ".concat(e.t0.message)),e.t0;case 19:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(t){return e.apply(this,arguments)}}(),L=b,I={identify:(E=t(y.mark((function e(t,r,n){var o,i,a;return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="".concat(L,"app-user/start-session"),i={},n&&(i.user_key=r),n&&(i.user_session_key=n),e.prev=4,e.next=7,j({apiKey:t,url:o,method:"POST",body:{},headers:i});case 7:if(!(a=e.sent).success){e.next=10;break}return e.abrupt("return",a);case 10:console.error("QUALLI: Failed to identify user"),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(4),console.error("QUALLI: Failed to identify user: ",e.t0),e.abrupt("return",{success:!1});case 17:case"end":return e.stop()}}),e,null,[[4,13]])}))),function(e,t,r){return E.apply(this,arguments)}),setUserAttributes:(S=t(y.mark((function e(t,r,n){var o,i;return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Object.keys(n).length){e.next=2;break}return e.abrupt("return");case 2:if(o="".concat(L,"app-user/set-attributes"),r){e.next=6;break}return console.error("QUALLI: No session ID available"),e.abrupt("return");case 6:return i={"user-session-key":r},e.prev=7,e.next=10,j({apiKey:t,url:o,method:"POST",headers:i,body:{attributes:n,timestamp:new Date}});case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(7),console.error("QUALLI: Error setting user attributes: ",e.t0);case 15:case"end":return e.stop()}}),e,null,[[7,12]])}))),function(e,t,r){return S.apply(this,arguments)}),performTrigger:(O=t(y.mark((function e(t,r,n){var o,i,a;return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n&&n.name){e.next=2;break}return e.abrupt("return");case 2:if(o="".concat(L,"app-user-events/trigger"),r){e.next=6;break}return console.error("QUALLI: No session ID available"),e.abrupt("return");case 6:return i={"user-session-key":r},e.prev=7,e.next=10,j({apiKey:t,url:o,method:"POST",headers:i,body:{trigger:n,timestamp:new Date}});case 10:if(!(a=e.sent).success){e.next=13;break}return e.abrupt("return",a);case 13:console.error("QUALLI: Error performing trigger"),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(7),console.error("QUALLI: Error performing trigger: ",e.t0);case 19:case"end":return e.stop()}}),e,null,[[7,16]])}))),function(e,t,r){return O.apply(this,arguments)}),trackScreen:(k=t(y.mark((function e(t,r,n){var o,i,a;return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n&&n.url){e.next=2;break}return e.abrupt("return");case 2:if(o="".concat(L,"app-user-events/screen"),r){e.next=6;break}return console.error("QUALLI: No session ID available"),e.abrupt("return");case 6:return i={"user-session-key":r},e.prev=7,e.next=10,j({apiKey:t,url:o,method:"POST",headers:i,body:{screen:n,timestamp:new Date}});case 10:if(!(a=e.sent).success){e.next=13;break}return e.abrupt("return",a);case 13:console.error("QUALLI: Error performing track screen"),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(7),console.error("QUALLI: Error performing track screen: ",e.t0);case 19:case"end":return e.stop()}}),e,null,[[7,16]])}))),function(e,t,r){return k.apply(this,arguments)}),logSurveyAction:(x=t(y.mark((function e(t,r,n,o,i){var a,s;return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a="".concat(L,"surveys/").concat(n,"/action"),r){e.next=4;break}return console.error("QUALLI: No session ID available"),e.abrupt("return");case 4:return s={"user-session-key":r},e.prev=5,e.next=8,j({apiKey:t,url:a,method:"POST",headers:s,body:{action:o,data:i,timestamp:new Date}});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),console.error("QUALLI: Error logging the survey action: ",e.t0);case 13:case"end":return e.stop()}}),e,null,[[5,10]])}))),function(e,t,r,n,o){return x.apply(this,arguments)}),logEvent:(w=t(y.mark((function e(t,r,n){var o,i;return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o="".concat(L,"app-user-events/store"),r){e.next=4;break}return console.error("QUALLI: No session ID available"),e.abrupt("return");case 4:return i={"user-session-key":r},e.prev=5,e.next=8,j({apiKey:t,url:o,method:"POST",headers:i,body:{action:n,event_name:n,timestamp:new Date}});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),console.error("QUALLI: Error logging the action: ",e.t0);case 13:case"end":return e.stop()}}),e,null,[[5,10]])}))),function(e,t,r){return w.apply(this,arguments)})},P={screens:{large:{position:"fixed",width:"350px",height:"250px",bottom:"-100%","border-radius":"12px",border:"none",opacity:1,transition:"all 400ms ease-in-out"},small:{position:"fixed",left:"16px",right:"16px",bottom:"-100%",width:"calc(100% - 32px)",height:"200px","border-radius":"12px",border:"none","max-height":"100%",transition:"all 400ms ease-in-out"}},popupPlacement:{left:{left:"24px"},center:{left:"50%",transform:"translate(-50%, 0)"},right:{right:"24px"}},person:{base:{small:{position:"fixed",opacity:0,transition:"all 400ms ease-in-out",cursor:"pointer",bottom:"16px",background:"none",overflow:"hidden"},large:{position:"fixed",opacity:0,transition:"all 400ms ease-in-out",cursor:"pointer",bottom:"24px",background:"none",overflow:"hidden"}},type:{circle:{small:{width:"50px",height:"50px","border-radius":"50%"},large:{width:"60px",height:"60px","border-radius":"50%"}},rectangle:{small:{width:"50px",height:"75px","border-radius":"6px"},large:{width:"50px",height:"75px","border-radius":"6px"}}},position:{small:{bottom_left:{left:"16px"},bottom_center:{left:"50%",transform:"translate(-50%, 0)"},bottom_right:{right:"16px"}},large:{bottom_left:{left:"24px"},bottom_center:{left:"50%",transform:"translate(-50%, 0)"},bottom_right:{right:"24px"}}}}},T=function(e){return e.none="none",e.small="small",e.medium="medium",e.large="large",e}({}),C=function(e){return e.SURVEY_COMPLETED="survey_completed",e.SURVEY_SHOWN="survey_shown",e.SURVEY_CLOSED="survey_closed",e}({}),U=function(){function e(){r(this,e),s(this,"events",{})}return a(e,[{key:"on",value:function(e,t){var r=this;return this.events[e]||(this.events[e]=[]),this.events[e].push(t),function(){return r.off(e,t)}}},{key:"off",value:function(e,t){this.events[e]&&(this.events[e]=this.events[e].filter((function(e){return e!==t})))}},{key:"emit",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.events[e]&&this.events[e].forEach((function(e){return e.apply(void 0,r)}))}}]),e}(),A=new U;function D(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?D(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Q=function(){function e(){var t=this;r(this,e),s(this,"company",{}),s(this,"ready",!1),s(this,"_popupId","qualli-survey-popup-iframe"),s(this,"_personId","qualli-survey-person"),s(this,"_userSessionKey",""),s(this,"_userKey",""),s(this,"_apiKey",""),s(this,"_popupInFrame",!1),s(this,"_previousUrl",""),s(this,"_triggerQueue",[]),s(this,"_attributesQueue",[]),s(this,"_postMessage",(function(e,r){var n=document.getElementById(t._popupId);n&&n.contentWindow.postMessage({message:{type:e,data:r}},"*")})),this._handleIframeMessages=this._handleIframeMessages.bind(this)}var n,o,i,u;return a(e,[{key:"init",value:(u=t(y.mark((function e(t,r){var n,o,i;return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=v.get("qualli_user_key"),o=v.get("qualli_user_session_key"),this._apiKey=t,e.next=5,I.identify(t,n,o);case 5:if(null!=(i=e.sent)&&i.success&&null!=i&&i.app_user_key&&null!=i&&i.session_key){e.next=8;break}return e.abrupt("return");case 8:v.set("qualli_user_session_key",i.session_key),v.set("qualli_user_key",i.app_user_key),this._userSessionKey=i.session_key,this._userKey=i.app_user_key,this.company=i.company_info,this.ready=!0,(null!=r&&r.trackScreens||!r)&&(this._trackScreenChange(),this._setupScreenTracking()),this._checkQueueAfterInit();case 16:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"_checkQueueAfterInit",value:(i=t(y.mark((function e(){var r=this;return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this._attributesQueue.length>0)){e.next=3;break}return e.next=3,Promise.all(this._attributesQueue.map(function(){var e=t(y.mark((function e(t){return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.setAttributes(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:this._triggerQueue.length>0&&this._triggerQueue.forEach(function(){var e=t(y.mark((function e(t){return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.performTrigger(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"performTrigger",value:function(){var e=t(y.mark((function e(t){var r,n,o,i,a;return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ready){e.next=3;break}return this._triggerQueue.push(t),e.abrupt("return");case 3:return e.next=5,I.performTrigger(this._apiKey,this._userSessionKey,{name:t});case 5:if(null==(r=e.sent)||!r.success){e.next=16;break}if(!((null==(o=null==r||null===(n=r.data)||void 0===n||null===(n=n.surveys)||void 0===n?void 0:n.data)?void 0:o.length)>0)){e.next=16;break}if(this._popupInFrame){e.next=16;break}if(!(null===(i=o[0])||void 0===i?void 0:i.delay)){e.next=14;break}return this._handleSurveyDelay(o[0],null==r||null===(a=r.data)||void 0===a?void 0:a.timestamp),e.abrupt("return");case 14:return this._showPopup(o[0]),e.abrupt("return");case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setAttributes",value:(o=t(y.mark((function e(){var t,r=arguments;return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.length>0&&void 0!==r[0]?r[0]:{},this.ready){e.next=4;break}return this._attributesQueue.push(t),e.abrupt("return");case 4:return e.next=6,I.setUserAttributes(this._apiKey,this._userSessionKey,t);case 6:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"reset",value:function(){var e=this;this._popupInFrame&&this._closePopup(),v.remove("qualli_user_session_key"),v.remove("qualli_user_key"),this.ready=!1,this._userSessionKey="",this._userKey="",this._surveyToComplete=void 0,this._popupInFrame=!1,this._previousUrl="",setTimeout((function(){e.init(e._apiKey)}),1e3)}},{key:"on",value:function(e,t){return A.on(e,t),function(){A.off(e,t)}}},{key:"_setupScreenTracking",value:function(){var e=this,t=history.pushState,r=history.replaceState;history.pushState=function(){for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];t.apply(history,n),e._trackScreenChange()},history.replaceState=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];r.apply(history,n),e._trackScreenChange()},window.addEventListener("popstate",(function(){e._trackScreenChange()}))}},{key:"_trackScreenChange",value:(n=t(y.mark((function e(){var t,r,n,o,i,a,s;return y.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window.location.href,(r=t.split("?")[0])!==this._previousUrl){e.next=4;break}return e.abrupt("return");case 4:return this._previousUrl=r,e.next=7,I.trackScreen(this._apiKey,this._userSessionKey,{url:r});case 7:if(null==(n=e.sent)||!n.success){e.next=18;break}if(!((null==(i=null==n||null===(o=n.data)||void 0===o||null===(o=o.surveys)||void 0===o?void 0:o.data)?void 0:i.length)>0)){e.next=18;break}if(this._popupInFrame){e.next=18;break}if(!(null===(a=i[0])||void 0===a?void 0:a.delay)){e.next=16;break}return this._handleSurveyDelay(i[0],null==n||null===(s=n.data)||void 0===s?void 0:s.timestamp),e.abrupt("return");case 16:return this._showPopup(i[0]),e.abrupt("return");case 18:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_showPopup",value:function(e){this._surveyToComplete=e,this._popupInFrame=!0;var t=window.innerWidth>600,r=document.createElement("iframe"),n={survey_id:e.unique_identifier,popup:"true"},o=Object.keys(n).map((function(e){return e+"="+n[e]})).join("&"),i=(null==e?void 0:e.popup_placement)||"bottom_right",a=function(e){switch(e){case T.none:return 0;case T.small:return 10;case T.medium:return 18;case T.large:return 24;default:return 10}}(e.theme.popup_rounded_corners||T.medium),s=e.theme.popup_border_width+"px"||"0px",u=P.popupPlacement.left;"bottom_right"===i?u=P.popupPlacement.right:"bottom_center"===i&&(u=P.popupPlacement.center);var c={};t?Object.assign(c,K(K({},P.screens.large),u)):Object.assign(c,K({},P.screens.small)),Object.assign(c,{borderRadius:a,borderColor:"#000000",borderWidth:s,backgroundColor:e.theme.background_color,border:"solid",zIndex:999}),Object.assign(r.style,c),r.src="".concat(m,"?").concat(o),r.id=this._popupId,document.body.appendChild(r);var p=null==e?void 0:e.person;if(p&&p.video_url){this._addPerson(p,(function(){setTimeout((function(){"circle"===p.style.type?r.style.bottom="100px":r.style.bottom="115px"}),"2-step"===p.logic?0:800)}),t,e)}else setTimeout((function(){window.innerWidth<600?r.style.bottom="16px":r.style.bottom="24px"}),100);window.addEventListener("message",this._handleIframeMessages,!1),this._emitSurvetShown(e)}},{key:"_emitSurvetShown",value:function(e){var t;A.emit(C.SURVEY_SHOWN,{survey_unique_identifier:null===(t=this._surveyToComplete)||void 0===t?void 0:t.unique_identifier})}},{key:"_handleSurveyDelay",value:function(e,t){var r=this;this._surveyToComplete=e,this._popupInFrame=!0;var n=e.delay,o=new Date(t);o.setSeconds(o.getSeconds()+n);var i=setInterval((function(){new Date>=o&&(r._showPopup(e),clearInterval(i))}),200)}},{key:"_handleIframeMessages",value:function(e){var t;if(null!=e&&null!==(t=e.data)&&void 0!==t&&t.message){var r,n,o=e.data.message;if("close"===o.type&&this._closePopup(),"ready"===o.type)this._postMessage("survey_to_complete",this._surveyToComplete),this._postMessage("auth",{userSessionKey:this._userSessionKey,apiKey:this._apiKey,companyPlan:null===(r=this.company)||void 0===r?void 0:r.plan});if("survey_completed"===o.type)A.emit(C.SURVEY_COMPLETED,{survey_unique_identifier:null===(n=this._surveyToComplete)||void 0===n?void 0:n.unique_identifier,answers:o.data.answers});if("survey_aborted"===o.type&&this._closePopup(),"window_height_request"===o.type){var i=o.data.height;this._resizePopup(i)}}}},{key:"_resizePopup",value:function(e){if(!isNaN(e)){var t,r=document.getElementById(this._popupId),n=e,o=null==r||null===(t=r.style)||void 0===t?void 0:t.borderWidth,i=new RegExp("^\\d+(px)?$");o&&i.test(o)&&(n-=parseInt(o)),r&&(r.style.height=n+"px")}}},{key:"_closePopup",value:function(){var e;this._popupInFrame=!1,window.removeEventListener("message",this._handleIframeMessages),A.emit(C.SURVEY_CLOSED,{survey_unique_identifier:null===(e=this._surveyToComplete)||void 0===e?void 0:e.unique_identifier});var t=document.getElementById(this._popupId),r=document.getElementById(this._personId);t&&(t.style.bottom="-100%",t.style.opacity="0",setTimeout((function(){t.remove()}),1e3)),r&&(r.style.opacity="0",r.remove())}},{key:"_addPerson",value:function(e,t,r,n){var o=document.createElement("div"),i=document.createElement("video");i.src=e.video_url,i.loop=!0,i.muted=!0,i.autoplay=!0,i.playsInline=!0,o.id=this._personId;var a={},s={},u={},c=P.person.position.large;switch(r||(c=P.person.position.small),n.popup_placement||"bottom_right"){case"bottom_left":Object.assign(a,K({},c.bottom_left));break;case"bottom_center":Object.assign(a,K({},c.bottom_center));break;case"bottom_right":Object.assign(a,K({},c.bottom_right))}"circle"===e.style.type?Object.assign(s,K({},P.person.type.circle.large)):Object.assign(s,K({},P.person.type.rectangle.large)),Object.assign(u,K({},P.person.base.large)),Object.assign(o.style,K(K(K(K({},u),s),a),{},{border:"solid ".concat(e.style.border_width,"px ").concat(e.style.border_color)})),i.style.width="100%",i.style.height="100%",i.style.objectFit="cover","2-step"===e.logic&&(o.onclick=t),document.body.appendChild(o),o.appendChild(i),setTimeout((function(){o.style.opacity="1","1-step"===e.logic&&t()}),400)}}]),e}();return new Q}();
//# sourceMappingURL=index.browser.js.map
